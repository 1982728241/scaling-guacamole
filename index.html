<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>AI NPC é€‚é…Doubao-Seed-1.8æ¨¡å‹</title>
    <style>
        * {margin:0;padding:0;box-sizing: border-box;font-family: "å¾®è½¯é›…é»‘", sans-serif;}
        body {background: #1d2939;padding: 20px;color:#fff;}
        .game-box {width: 1000px;margin:0 auto;border: 2px solid #6b7280;border-radius: 8px;background: #111827;padding:15px;}
        .npc-select {margin-bottom:15px;padding:10px;background:#27272a;border-radius:6px;}
        .npc-select button {padding:8px 15px;margin:0 5px;border:none;border-radius:4px;background:#3b82f6;color:#fff;cursor:pointer;}
        .npc-select button:hover {background:#2563eb;}
        .npc-info {padding:10px;background:#0f172a;border-radius:6px;margin-bottom:15px;line-height:1.8;}
        .dialog-box {width:100%;height:350px;border:1px solid #6b7280;border-radius:6px;padding:10px;background:#030712;overflow-y:auto;margin-bottom:15px;}
        .dialog-item {margin-bottom:10px;padding:8px;border-radius:6px;max-width:90%;}
        .player-dialog {background:#3b82f6;margin-left:auto;text-align:right;}
        .npc-dialog {background:#4b5563;margin-right:auto;text-align:left;}
        .api-tip {padding:10px;background:#f59e0b;border-radius:6px;margin-bottom:15px;color:#111;}
        .input-box {display:flex;gap:10px;margin-bottom:15px;}
        #playerInput {flex:1;padding:10px;border:1px solid #6b7280;border-radius:6px;background:#1f2937;color:#fff;font-size:16px;outline:none;}
        #sendBtn {padding:0 20px;border:none;border-radius:6px;background:#10b981;color:#fff;cursor:pointer;font-size:16px;}
        #sendBtn:hover {background:#059669;}
        .func-panel {display:flex;gap:10px;margin-bottom:15px;}
        .func-panel button {flex:1;padding:12px;border:none;border-radius:6px;color:#fff;cursor:pointer;font-size:16px;}
        #collectBtn {background:#84cc16;}
        #mineBtn {background:#b45309;}
        #fightBtn {background:#ef4444;}
        .status-panel {display:flex;gap:15px;padding:10px;background:#27272a;border-radius:6px;}
        .status-item {flex:1;line-height:1.8;}
        b {color:#fbbf24;}
    </style>
</head>
<body>
    <div class="game-box">
        <div class="api-tip">
            ğŸ“Œ é€‚é…Doubao-Seed-1.8æ¨¡å‹ | æ”¯æŒå›¾æ–‡è¾“å…¥
        </div>
        <div class="input-box" style="margin-bottom:15px;">
            <input type="text" id="apiKeyInput" placeholder="è¯·è¾“å…¥ä½ çš„ç«å±±æ–¹èˆŸAPI-KEY" style="flex:1;">
        </div>
        <div class="input-box" style="margin-bottom:15px;">
            <input type="text" id="imgUrlInput" placeholder="ç²˜è´´å›¾ç‰‡é“¾æ¥ï¼ˆå¯é€‰ï¼‰" style="flex:1;">
        </div>
        <div class="npc-select">
            <button onclick="changeNPC('liya')">âœ… ç»¿æ´²ä¹‹åŸ - è‰å¨…(é‡‡é›†/ç‚¼é‡‘Â·æ¸©æŸ”)</button>
            <button onclick="changeNPC('senen')">â›ï¸ ç»¿å¶ç²¾çµåŸ - æ£®æ©(æŒ–çŸ¿/é”»é€ Â·ç²—çŠ·)</button>
            <button onclick="changeNPC('huoke')">âš”ï¸ è¾¹å¢ƒå°é•‡ - éœå…‹(æˆ˜æ–—/ç‹©çŒÂ·æ²‰ç¨³)</button>
        </div>
        <div class="npc-info" id="npcInfo">
            <b>å½“å‰NPCï¼š</b>ç»¿æ´²ä¹‹åŸ - è‰å¨…<br>
            <b>æ€§æ ¼ï¼š</b>æ´»æ³¼æ¸©æŸ” | <b>æ“…é•¿ï¼š</b>é‡‡é›†ã€ç‚¼é‡‘ | <b>å£å¤´ç¦…ï¼š</b>å‘€ï¼Œè¿™ä¸ªè¯è‰è¶…ç¨€æœ‰å‘¢ï¼
        </div>
        <div class="dialog-box" id="dialogBox">
            <div class="dialog-item npc-dialog">ä½ å¥½å‘€ï½æˆ‘æ˜¯è‰å¨…ï¼Œæœ‰ä»€ä¹ˆæƒ³é—®æˆ‘çš„éƒ½å¯ä»¥è¯´å“¦âœ¨</div>
        </div>
        <div class="input-box">
            <input type="text" id="playerInput" placeholder="è¾“å…¥ä½ çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼šå“ªé‡Œé‡‡é›†è¯è‰ï¼Ÿ">
            <button id="sendBtn" onclick="sendMsg()">å‘é€å¯¹è¯</button>
        </div>
        <div class="func-panel">
            <button id="collectBtn" onclick="doCollect()">ğŸŒ¿ é‡‡é›†è¯è‰</button>
            <button id="mineBtn" onclick="doMine()">â›°ï¸ æŒ–æ˜çŸ¿çŸ³</button>
            <button id="fightBtn" onclick="doFight()">âš”ï¸ æˆ˜æ–—æ‰“æ€ª</button>
        </div>
        <div class="status-panel">
            <div class="status-item">
                <b>å½“å‰BUFFçŠ¶æ€ï¼š</b><span id="buffStatus">æ— BUFF</span><br>
                <b>BUFFå‰©ä½™æ—¶é—´ï¼š</b><span id="buffTime">0 ç§’</span>
            </div>
            <div class="status-item">
                <b>ç»¿æ´²å£°æœ›ï¼š</b><span id="shengwangLiya">0</span><br>
                <b>ç»¿å¶å£°æœ›ï¼š</b><span id="shengwangSenen">0</span><br>
                <b>è¾¹å¢ƒå£°æœ›ï¼š</b><span id="shengwangHuoke">0</span>
            </div>
            <div class="status-item">
                <b>è¯è‰æ•°é‡ï¼š</b><span id="herbNum">0</span><br>
                <b>çŸ¿çŸ³æ•°é‡ï¼š</b><span id="oreNum">0</span><br>
                <b>è§’è‰²ç»éªŒï¼š</b><span id="expNum">0</span>
            </div>
        </div>
    </div>

    <script>
        let playerData = {herb:0,ore:0,exp:0,shengwang:{liya:0,senen:0,huoke:0},buff:{name:"",active:false,time:0,effect:""},memory:[],memoryMax:5};
        const NPC_CONFIG = {
            liya:{
                name:"ç»¿æ´²ä¹‹åŸ - è‰å¨…",
                personality:"æ´»æ³¼æ¸©æŸ”ã€çƒ­å¿ƒè‚ ï¼Œè¯´è¯å¸¦ï½è¯­æ°”è¯",
                specialty:"é‡‡é›†è¯è‰ã€ç‚¼é‡‘",
                mantra:"å‘€ï¼Œè¿™ä¸ªè¯è‰è¶…ç¨€æœ‰å‘¢ï¼",
                buff:{name:"é‡‡é›†å¹¸è¿",effect:"ç¨€æœ‰è¯è‰æ¦‚ç‡+30%",duration:120},
                buffKeys:["é‡‡é›†","è¯è‰","ç‚¼é‡‘"]
            },
            senen:{
                name:"ç»¿å¶ç²¾çµåŸ - æ£®æ©",
                personality:"ç²—çŠ·ç›´çˆ½ï¼Œè¯´è¯å¸¦ï¼è¯­æ°”è¯",
                specialty:"æŒ–çŸ¿ã€é”»é€ ",
                mantra:"å¥½çŸ¿ï¼é”»å‡ºæ¥çš„è£…å¤‡è‚¯å®šé¡¶ï¼",
                buff:{name:"æŒ–çŸ¿æš´å‡»",effect:"çŸ¿çŸ³æ•°é‡Ã—2",duration:120},
                buffKeys:["æŒ–çŸ¿","çŸ¿çŸ³","é”»é€ "]
            },
            huoke:{
                name:"è¾¹å¢ƒå°é•‡ - éœå…‹",
                personality:"æ²‰ç¨³å¯é ï¼Œè¯´è¯å¸¦ã€‚è¯­æ°”è¯",
                specialty:"æˆ˜æ–—ã€ç‹©çŒ",
                mantra:"è®°ä½ï¼Œæ€ªç‰©çš„å¼±ç‚¹æ°¸è¿œåœ¨ç ´ç»½å¤„ã€‚",
                buff:{name:"å¼±ç‚¹ç¿»å€",effect:"ä¼¤å®³Ã—2",duration:120},
                buffKeys:["æˆ˜æ–—","æ‰“æ€ª","å¼±ç‚¹"]
            }
        };
        let currentNPC = "liya";let buffTimer = null;
        // é€‚é…Doubao-Seed-1.8çš„Responsesæ¨¡å¼æ¥å£åœ°å€
        const API_URL = "https://ark.cn-beijing.volces.com/api/v3/responses";

        function updateStatus(){
            document.getElementById("herbNum").innerText=playerData.herb;
            document.getElementById("oreNum").innerText=playerData.ore;
            document.getElementById("expNum").innerText=playerData.exp;
            document.getElementById("shengwangLiya").innerText=playerData.shengwang.liya;
            document.getElementById("shengwangSenen").innerText=playerData.shengwang.senen;
            document.getElementById("shengwangHuoke").innerText=playerData.shengwang.huoke;
            if(playerData.buff.active){
                document.getElementById("buffStatus").innerText=playerData.buff.name+" | "+playerData.buff.effect;
                document.getElementById("buffTime").innerText=playerData.buff.time+" ç§’";
            }else{
                document.getElementById("buffStatus").innerText="æ— BUFF";
                document.getElementById("buffTime").innerText="0 ç§’";
            }
        }

        function addDialog(content,isPlayer){
            let dialogBox = document.getElementById("dialogBox");
            let dialogItem = document.createElement("div");
            dialogItem.className = isPlayer ? "dialog-item player-dialog" : "dialog-item npc-dialog";
            dialogItem.innerText = content || "ï¼ˆNPCæ€è€ƒä¸­...ï¼‰";
            dialogBox.appendChild(dialogItem);
            dialogBox.scrollTop = dialogBox.scrollHeight;
        }

        function addBuff(buffCfg){
            if(buffTimer) clearInterval(buffTimer);
            playerData.buff = {
                name: buffCfg.name,
                active: true,
                time: buffCfg.duration,
                effect: buffCfg.effect
            };
            updateStatus();
            buffTimer = setInterval(()=>{
                playerData.buff.time--;
                updateStatus();
                if(playerData.buff.time <= 0){
                    clearInterval(buffTimer);
                    playerData.buff.active = false;
                    updateStatus();
                    addDialog(`ã€ç³»ç»Ÿã€‘ä½ çš„ã€Œ${buffCfg.name}ã€BUFFå¤±æ•ˆå•¦ï½`,false);
                }
            },1000);
        }

        async function sendMsg() {
            let apiKey = document.getElementById("apiKeyInput").value.trim();
            let playerMsg = document.getElementById("playerInput").value.trim();
            let imgUrl = document.getElementById("imgUrlInput").value.trim();
            
            if(!playerMsg) {
                addDialog("ã€æç¤ºã€‘è¯·è¾“å…¥ä½ çš„é—®é¢˜ï½", false);
                return;
            }
            if(!apiKey) {
                addDialog("ã€æç¤ºã€‘è¯·å…ˆè¾“å…¥API-KEYï½", false);
                return;
            }

            addDialog(playerMsg, true);
            document.getElementById("playerInput").value = "";
            addDialog("ã€NPCæ­£åœ¨æ€è€ƒ...ã€‘", false);

            let npc = NPC_CONFIG[currentNPC];
            // æ„å»ºå¤šæ¨¡æ€è¾“å…¥å†…å®¹
            let content = [
                {
                    "type": "input_text",
                    "text": `ä½ æ˜¯æ¸¸æˆNPCã€${npc.name}ã€‘ï¼Œæ€§æ ¼${npc.personality}ï¼Œæ“…é•¿${npc.specialty}ã€‚ç©å®¶é—®ï¼š${playerMsg}ã€‚å›å¤è¦è´´åˆäººè®¾ï¼Œ1-3å¥è¯ï¼Œè‡ªç„¶å£è¯­åŒ–ï¼Œå£å¤´ç¦…ä»…åœ¨å¯¹åº”è¯é¢˜æ—¶åŠ ã€‚`
                }
            ];
            // å¦‚æœæœ‰å›¾ç‰‡é“¾æ¥ï¼Œæ·»åŠ å›¾ç‰‡è¾“å…¥
            if(imgUrl) {
                content.unshift({
                    "type": "input_image",
                    "image_url": imgUrl
                });
            }

            try {
                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${apiKey}`,
                        "Accept": "*/*",
                        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
                    },
                    body: JSON.stringify({
                        model: "doubao-seed-1-8-251228", // ä½ çš„æ¨¡å‹ID
                        input: [
                            {
                                "role": "user",
                                "content": content
                            }
                        ]
                    })
                });

                if(!response.ok) throw new Error(`æ¥å£çŠ¶æ€ç ï¼š${response.status}`);
                const result = await response.json();
                // Doubao-Seedæ¨¡å‹çš„å›å¤å­—æ®µæ˜¯answer
                let finalReply = result.answer || `æˆ‘ä¸å¤ªæ¸…æ¥šä½ è¯´çš„å‘¢ï½${npc.mantra}`;
                // è‡ªç„¶æ‹¼æ¥å£å¤´ç¦…
                if(!finalReply.includes(npc.mantra) && playerMsg.includes(npc.buffKeys[0])){
                    finalReply += " " + npc.mantra;
                }

                document.getElementById("dialogBox").lastChild.remove();
                addDialog(finalReply, false);

                // è§¦å‘BUFF
                let matchKey = npc.buffKeys.find(key => playerMsg.includes(key));
                if(matchKey){
                    addBuff(npc.buff);
                    playerData.shengwang[currentNPC] += 3;
                    updateStatus();
                }

            } catch (error) {
                document.getElementById("dialogBox").lastChild.remove();
                const errorReplies = [
                    `å’¦ï¼Œåˆšæ‰å¥½åƒå¡äº†ä¸€ä¸‹ï½ä½ å†è¯´ä¸€éå¥½ä¸å¥½å‘€ï¼Ÿ`,
                    `æŠ±æ­‰å“¦ï¼Œæˆ‘åˆšæ‰æ²¡å¬æ¸…ï½èƒ½å†è·Ÿæˆ‘è¯´ä¸€æ¬¡å—ï¼Ÿ`
                ];
                const randomIdx = Math.floor(Math.random() * errorReplies.length);
                addDialog(errorReplies[randomIdx], false);
                console.log("é”™è¯¯ï¼š", error);
            }
        }

        function doCollect(){
            let herbNum = 1;
            let expNum = 5;
            if(playerData.buff.active && playerData.buff.name === "é‡‡é›†å¹¸è¿"){
                herbNum = 2;
                expNum = 10;
                addDialog(`ã€é‡‡é›†ã€‘âœ¨ è§¦å‘ç¨€æœ‰è¯è‰ï¼è·å¾—Ã—${herbNum}è¯è‰ï¼Œç»éªŒ+${expNum}ï¼`,false);
            }else{
                addDialog(`ã€é‡‡é›†ã€‘ä½ é‡‡é›†åˆ°äº†Ã—${herbNum}æ ªè–„è·è‰ï¼Œç»éªŒ+${expNum}ï½`,false);
            }
            playerData.herb += herbNum;
            playerData.exp += expNum;
            updateStatus();
        }

        function doMine(){
            let oreNum = 1;
            let expNum = 5;
            if(playerData.buff.active && playerData.buff.name === "æŒ–çŸ¿æš´å‡»"){
                oreNum = 2;
                expNum = 10;
                addDialog(`ã€æŒ–çŸ¿ã€‘ğŸ’¥ æŒ–çŸ¿æš´å‡»ï¼è·å¾—Ã—${oreNum}å—é“çŸ¿ï¼Œç»éªŒ+${expNum}ï¼`,false);
            }else{
                addDialog(`ã€æŒ–çŸ¿ã€‘ä½ æŒ–åˆ°äº†Ã—${oreNum}å—é“œçŸ¿ï¼Œç»éªŒ+${expNum}ï½`,false);
            }
            playerData.ore += oreNum;
            playerData.exp += expNum;
            updateStatus();
        }

        function doFight(){
            let expNum = 10;
            const monsters = ["å“¥å¸ƒæ—","å²è±å§†","å…½äººå°å…µ"];
            const randomMonster = monsters[Math.floor(Math.random() * monsters.length)];
            if(playerData.buff.active && playerData.buff.name === "å¼±ç‚¹ç¿»å€"){
                expNum = 20;
                addDialog(`ã€æˆ˜æ–—ã€‘âš”ï¸ å‘½ä¸­${randomMonster}å¼±ç‚¹ï¼è·å¾—ç»éªŒ+${expNum}ï¼`,false);
            }else{
                addDialog(`ã€æˆ˜æ–—ã€‘ä½ å‡»è´¥äº†${randomMonster}ï¼Œè·å¾—ç»éªŒ+${expNum}ï½`,false);
            }
            playerData.exp += expNum;
            updateStatus();
        }

        function changeNPC(npcKey){
            currentNPC = npcKey;
            const npc = NPC_CONFIG[npcKey];
            document.getElementById("npcInfo").innerHTML = 
                `<b>å½“å‰NPCï¼š</b>${npc.name}<br>
                <b>æ€§æ ¼ï¼š</b>${npc.personality} | <b>æ“…é•¿ï¼š</b>${npc.specialty} | <b>å£å¤´ç¦…ï¼š</b>${npc.mantra}`;
            addDialog(`ä½ åˆ‡æ¢åˆ°äº†ã€${npc.name}ã€‘ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜éƒ½å¯ä»¥é—®æˆ‘å“¦ï½`,false);
            playerData.memory = [];
        }

        window.onload=function(){
            updateStatus();
            document.getElementById("playerInput").onkeydown=e=>{
                if(e.keyCode === 13) sendMsg();
            };
        };
    </script>
</body>
</html>